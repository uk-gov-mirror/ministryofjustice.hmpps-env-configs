---
- name: Generate webhook secret
  set_fact:
    wehbook_secret_key: "{{ lookup('password', '/dev/null length=64 chars=hexdigits') }}"
  no_log: true

- name: Set playbook facts
  set_fact:
    webhook_ssm_key: /codepipeline/webhooks/secret

- name: Add webhook secret to parameter store
  aws_ssm_parameter_store:
    name: "{{ webhook_ssm_key }}"
    description: ARN of the CodeBuild Source Credentials holder, containing the GitHub access token.
    string_type: SecureString
    value: "{{ wehbook_secret_key }}"
    overwrite_value: never
